#include "uav.h"

/*
 ******************************************************************************
 * DEFINES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXTERNS
 ******************************************************************************
 */

/*
 ******************************************************************************
 * GLOBAL VARIABLES
 ******************************************************************************
 */

/*
 *******************************************************************************
 *******************************************************************************
 * LOCAL FUNCTIONS
 *******************************************************************************
 *******************************************************************************
 */

/**
 *
 */
static WORKING_AREA(AutopilotThreadWA, 512);
Thread *autopilot_tp = NULL;
static msg_t AutopilotThread(void* arg){
  chRegSetThreadName("Autopilot");
  (void)arg;

  uint32_t i = 0;

  while (TRUE) {
    chThdSleepMilliseconds(20);
    /* testing values */
    Servo4Set(0);
    Servo5Set(64);
    Servo6Set(128);
    Servo7Set(255);
    ServoCarThrottleSet((i >> 2) & 0xFF);
    i++;
  }
  return 0;
}


/*
 *******************************************************************************
 * EXPORTED FUNCTIONS
 *******************************************************************************
 */
void ControllerInit(void){

  chThdCreateStatic(AutopilotThreadWA,
        sizeof(AutopilotThreadWA),
        NORMALPRIO,
        AutopilotThread,
        NULL);
}
