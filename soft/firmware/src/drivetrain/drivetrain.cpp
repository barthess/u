#include "main.h"
#include "drivetrain.hpp"
#include "servo.hpp"
#include "message.hpp"

/*
 ******************************************************************************
 * DEFINES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXTERNS
 ******************************************************************************
 */
extern mavlink_system_t   mavlink_system_struct;

/*
 ******************************************************************************
 * PROTOTYPES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * GLOBAL VARIABLES
 ******************************************************************************
 */

/*
 ******************************************************************************
 ******************************************************************************
 * LOCAL FUNCTIONS
 ******************************************************************************
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXPORTED FUNCTIONS
 ******************************************************************************
 */
/**
 *
 */
void Drivetrain::start(const Impact *impact){
  this->impact = impact;
  ServoInit();
}

/**
 *
 */
void Drivetrain::update(void){
  ServoCarYawSet(float2servo(impact->rud));

  /* motor control protected by safety bit */
  if (mavlink_system_struct.mode & MAV_MODE_FLAG_SAFETY_ARMED)
    ServoCarThrustSet(float2thrust(impact->thrust));
  else
    ServoCarThrustSet(float2thrust(0));
}


