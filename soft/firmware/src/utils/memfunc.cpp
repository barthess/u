#include <string.h>

#include "ch.h"
#include "hal.h"

/*
 ******************************************************************************
 * DEFINES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXTERNS
 ******************************************************************************
 */

/*
 ******************************************************************************
 * PROTOTYPES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * GLOBAL VARIABLES
 ******************************************************************************
 */

/*
 ******************************************************************************
 ******************************************************************************
 * LOCAL FUNCTIONS
 ******************************************************************************
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXPORTED FUNCTIONS
 ******************************************************************************
 */

/**
 * @brief Thread safe variant of memcpy function.
 *
 * @param[in] dest  destination pointer
 * @param[in] src   source pointer
 * @param[in] len   size of transaction
 * @param[in] try   number of trys, minimum 1
 *
 * @return  status of operation
 */
bool_t memcpy_ts(void *dest, const void *src, size_t len, uint32_t try){
  do{
    memcpy(dest, src, len);
  }while ((0 != memcmp(dest, src, len)) && ((try--) > 0));

  if (try > 0)
    return CH_SUCCESS;
  else
    return CH_FAILED;
}
